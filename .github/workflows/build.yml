name: Build LineageOS 22 for Odessa

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Set up environment
        run: |
          sudo apt update
          sudo apt install -y bc bison build-essential ccache curl flex git gnupg gperf libncurses5-dev libssl-dev zlib1g-dev liblz4-tool imagemagick libxml2-utils xsltproc unzip repo python-is-python3 openjdk-17-jdk

      - name: ğŸ“‚ Criar diretÃ³rio do projeto
        run: mkdir -p los

      - name: ğŸ§± Init & Sync sources
        run: |
          cd los
          repo init -u https://github.com/LineageOS/android.git -b lineage-22
          repo sync -j$(nproc) --force-sync

      - name: ğŸ§© Copiar device/vendor/kernel
        run: |
          cp -r $GITHUB_WORKSPACE/device   los/device
          cp -r $GITHUB_WORKSPACE/vendor   los/vendor
          cp -r $GITHUB_WORKSPACE/kernel   los/kernel

      - name: ğŸ§  Adicionar script de build
        run: |
          cat << 'EOF' > los/build.sh
          #!/bin/bash
          set -e
          source build/envsetup.sh
          lunch lineage_odessa-userdebug
          make bacon -j$(nproc)
          EOF
          chmod +x los/build.sh

      - name: ğŸ—ï¸ Build ROM
        run: |
          cd los
          ./build.sh

      - name: ğŸ“¤ Upload ROM zip
        uses: actions/upload-artifact@v4
        with:
          name: lineage-22-odessa
          path: los/out/target/product/odessa/*.zip
